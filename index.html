<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ×›×•×ª×¨×ª ××•×ª×××ª ×œ-SEO -->
    <title>×§×•×“×§×¡ ××•× ×—×™ ××©×—×§×™ ×ª×¤×§×™×“×™× | ××™×œ×•×Ÿ ×”×¨×¨"×¤ ×”××œ×</title>
    
    <!-- ×˜×¢×™× ×ª Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ×˜×¢×™× ×ª ×¤×•× ×˜ ALEF ×•-Inter (×›×—×œ×•×¤×”) -->
    <link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ×”×’×“×¨×ª ×”×¤×•× ×˜ ×”×¨××©×™ - ×××œ×¦×ª ×©×™××•×© ×‘-Alef */
        body {
            font-family: 'Alef', Inter, sans-serif;
            direction: rtl;
            text-align: right;
        }
    </style>
</head>

<!-- ×¨×§×¢ ×‘×”×™×¨, ×“××•×™ ×¤××¨×¦'×× ×˜/××’×™×œ×” - Stone-100 -->
<body class="bg-stone-100 text-gray-900 p-4 md:p-10">

    <div class="max-w-4xl mx-auto">
        
        <!-- ×›×•×ª×¨×ª ×¨××©×™×ª ×•××¢×‘×¨ ×œ××™×œ×•×Ÿ -->
        <header class="mb-10 p-4 bg-stone-200 shadow-lg border-b-4 border-amber-900 rounded-sm">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <!-- H1: ×¦×‘×¢ ×“×™×• ×¢××•×§ (Sepia) -->
                <h1 class="text-4xl md:text-5xl font-extrabold text-amber-900">×‘×¨×•×›×™× ×”×‘××™× ×œ×§×•×“×§×¡</h1>
                
                <!-- ×›×¤×ª×•×¨ ××¢×‘×¨ ×œ××™×œ×•×Ÿ ×”××œ× -->
                <a href="codex.html" class="inline-block px-6 py-3 bg-red-800 text-white text-lg font-bold rounded-sm shadow-md hover:bg-red-900 transition duration-300 transform hover:scale-[1.01] whitespace-nowrap">
                    ğŸ‘ˆ ××¢×‘×¨ ×œ××™×œ×•×Ÿ ×”××œ×
                </a>
            </div>
        </header>

        <!-- ×‘×œ×•×§ ××™×“×¢ ×¢×œ ×”×¤×¨×•×™×§×˜ -->
        <section class="mb-10 p-6 bg-white border-2 border-amber-700 rounded-sm shadow-lg text-lg">
            <h2 class="text-2xl font-bold text-amber-900 mb-3">××”×• ×”×§×•×“×§×¡?</h2>
            <p class="text-gray-700 leading-relaxed mb-3">
                ×”×§×•×“×§×¡ ×”×•× ××™×œ×•×Ÿ ×¢×‘×¨×™ ××§×™×£ ×œ××•× ×—×™× ××¢×•×œ× ××©×—×§×™ ×”×ª×¤×§×™×“×™× ×”×©×•×œ×—× ×™×™× (×¨×¨"×¤ - Role-Playing Games). ×”×•× × ×•×¢×“ ×œ×©××© ×›×›×œ×™ ×¢×–×¨ ×—×™×•× ×™ ×œ×©×—×§× ×™× ×•×× ×—×™×, ×—×“×©×™× ×•×•×ª×™×§×™× ×›××—×“, ×”××¢×•× ×™×™× ×™× ×œ×”×¢××™×§ ××ª ×”×‘× ×ª× ×‘×©×¤×” ×”××§×¦×•×¢×™×ª ×©×œ ×”×ª×—×•×.
            </p>
            <p class="text-gray-800 font-semibold mt-4">
                × ×›×•×Ÿ ×œ×¢×›×©×™×•, ×”×§×•×“×§×¡ ×›×•×œ×œ <span id="term-count" class="text-red-700 text-2xl font-extrabold">0</span> ××•× ×—×™× ××ª×•×¨×’××™× ×•××¤×•×¨×˜×™×.
            </p>
        </section>

        <!-- ×‘×œ×•×§ ×—×™×¤×•×© ××”×™×¨ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-amber-900 mb-4 border-b border-amber-900 pb-2">×—×™×¤×•×© ××”×™×¨</h2>
            
            <input type="text" id="home-search-input" placeholder="×—×¤×© ××™×œ×” ×‘×¢×‘×¨×™×ª ××• ×‘×× ×’×œ×™×ª (×œ×“×•×’××”: ×× ×—×”, DM, ×—×•×›××”)..."
                   class="w-full p-4 border-2 border-amber-900 bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-4 focus:ring-amber-700 transition duration-150 rounded-sm">
            
            <!-- ×”×˜×§×¡×˜ ×”×–×” ×™×©×ª× ×” ×œ×¤×™ ××¦×‘ ×”×—×™×¤×•×© -->
            <p id="search-status" class="text-sm text-gray-600 mt-2">×”×§×œ×“ ××™×œ×” ×‘×¢×‘×¨×™×ª ××• ×‘×× ×’×œ×™×ª ×›×“×™ ×œ×—×¤×© ×‘×§×•×“×§×¡.</p>
        </section>

        <!-- ××–×•×¨ ×ª×•×¦××•×ª ×”×—×™×¤×•×© -->
        <!-- ×”×¡×¨× ×• ××ª gap-6 ×›×“×™ ×©×”×›×¨×˜×™×¡×™× ×™×”×™×• ×¦××•×“×™× ×œ×—×œ×•×˜×™×Ÿ -->
        <section id="results-container" class="grid grid-cols-1 mb-10">
            <!-- ×ª×•×¦××•×ª ×”×—×™×¤×•×© ×™×•×¦×’×• ×›××Ÿ -->
        </section>

    </div>
    
    <!-- --- ×¤×•×˜×¨ - ×¨×’×œ ×”××¡××š --- -->
    <footer class="mt-12 pt-4 border-t-2 border-amber-900 bg-stone-200 text-center text-sm p-4 rounded-t-sm space-y-1 max-w-4xl mx-auto">
        <p class="text-amber-900">
            ×× ×•×”×œ ×¢"×™ <a href="https://rrpg.top" target="_blank" class="font-bold text-amber-700 hover:text-amber-900 underline transition">×’×œ×’×•×œ - ××©×—×§×™ ×ª×¤×§×™×“×™× ×œ××¢×Ÿ ×”×§×”×™×œ×”</a>
        </p>
        <p class="text-amber-900">
            ×¤×•×ª×— ×¢"×™ <a href="https://lp.reuven.click" target="_blank" class="font-bold text-amber-700 hover:text-amber-900 underline transition">×¨××•×‘×Ÿ ×× ×“×œ×•×‘×™×¥'</a>
        </p>
    </footer>

    <!-- JavaScript ×œ× ×™×”×•×œ ×”×—×™×¤×•×© ×•×”×§×™×©×•×¨ -->
    <script>
        // --- × ×ª×•× ×™ ×”××™×œ×•×Ÿ - ×™×™×˜×¢× ×• ×œ×›××Ÿ ×‘××•×¤×Ÿ ×-×¡×™× ×›×¨×•× ×™ ---
        let dictionaryData = []; 
        
        // --- ×§×‘×•×¢×™× ×•××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ---
        const searchInput = document.getElementById('home-search-input');
        const resultsContainer = document.getElementById('results-container');
        const searchStatus = document.getElementById('search-status');
        const termCountElement = document.getElementById('term-count');
        
        const MAX_PREVIEW_LENGTH = 100;
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ---
        function encodeWord(word) {
            return encodeURIComponent(word);
        }
        
        function truncateText(text, maxLength = MAX_PREVIEW_LENGTH) {
            if (text.length <= maxLength) {
                return text;
            }
            return text.substring(0, maxLength).trim() + '...';
        }

        /**
         * ×‘×•× ×” ××ª ×§×•×“ ×”-HTML ×©×œ ×‘×œ×•×§ ×ª×•×¦××ª ×—×™×¤×•×©.
         */
        function createResultCardHtml(item) {
            const encodedWord = encodeWord(item.word);
            const definitionPreview = truncateText(item.definition);

            // ×”×‘×œ×•×§ ×›×•×œ×• ×”×•× ×§×™×©×•×¨ ×©××•×‘×™×œ ×œ×“×£ ×”××™×œ×•×Ÿ ×¢× ×”-hash ×”××ª××™×.
            return `
                <a href="codex.html#${encodedWord}" 
                   class="p-4 bg-white flex justify-between items-start transition-all duration-200 hover:bg-amber-100 mt-2" 
                   title="×œ×—×¥ ×œ×¤×™×¨×•×˜ ×”××œ× ×¢×œ ×”××•× ×— ${item.word}">
                    
                    <!-- ×¦×“ ×™××™×Ÿ: ×¢×‘×¨×™×ª + ×× ×’×œ×™×ª -->
                    <div class="text-right flex-grow pr-4">
                        <h3 class="text-2xl font-extrabold text-amber-900 mb-1">${item.word}</h3>
                        <p class="text-sm text-gray-600 font-medium">${item.sourceEn}</p>
                    </div>

                    <!-- ×¦×“ ×©×××œ: ×ª×§×¦×™×¨ ×”×¤×™×¨×•×© -->
                    <div class="text-right w-2/3 pl-2">
                        <p class="text-gray-700 text-base leading-snug">${definitionPreview}</p>
                    </div>
                </a>
            `;
        }
        
        /**
         * ××¤×¢×™×œ ××ª ×”×—×™×¤×•×© ×•××¦×™×’ ×ª×•×¦××•×ª.
         * ×××•×™×Ÿ ×œ×¤×™ ×”×ª×××”: ××“×•×™×§ > ×”×ª×—×œ×” > ×”×›×œ×”. ××•×’×‘×œ ×œ-5 ×ª×•×¦××•×ª.
         */
        function applySearch() {
            // ×× ×”× ×ª×•× ×™× ×¢×“×™×™×Ÿ ×œ× × ×˜×¢× ×•, ××™×Ÿ ××” ×œ×—×¤×©
            if (dictionaryData.length === 0) {
                 searchStatus.textContent = 'âŒ ×××ª×™×Ÿ ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×”××™×œ×•×Ÿ (terms.json)...';
                 return;
            }

            const searchTerm = searchInput.value.toLowerCase().trim();
            const MAX_RESULTS = 5; // ×”×’×‘×œ×” ×œ-5 ×ª×•×¦××•×ª

            // ×× ×”××©×ª××© ×œ× ×”×§×œ×™×“ ××¡×¤×™×§, × ×§×” ××ª ×”×ª×•×¦××•×ª
            if (searchTerm.length < 2) {
                resultsContainer.innerHTML = '';
                searchStatus.textContent = '×”×§×œ×“ ×œ×¤×—×•×ª 2 ××•×ª×™×•×ª ×›×“×™ ×œ×”×ª×—×™×œ ×‘×—×™×¤×•×©...';
                return;
            }

            const scoredData = dictionaryData.map(item => {
                const wordLower = item.word.toLowerCase();
                const sourceEnLower = item.sourceEn.toLowerCase();
                let score = 0;

                // 1. ×¦×™×•×Ÿ 3: ×”×ª×××” ××“×•×™×§×ª (×¢×‘×¨×™×ª ××• ×× ×’×œ×™×ª) - ×”×›×™ ×—×©×•×‘
                if (wordLower === searchTerm || sourceEnLower === searchTerm) {
                    score = 3;
                }
                // 2. ×¦×™×•×Ÿ 2: ×”×ª×—×œ×” ×ª×•×××ª (×¢×‘×¨×™×ª ××• ×× ×’×œ×™×ª)
                else if (wordLower.startsWith(searchTerm) || sourceEnLower.startsWith(searchTerm)) {
                    score = 2;
                }
                // 3. ×¦×™×•×Ÿ 1: ×”×›×œ×” ×—×œ×§×™×ª ×‘××™×œ×” (×¢×‘×¨×™×ª ××• ×× ×’×œ×™×ª)
                else if (wordLower.includes(searchTerm) || sourceEnLower.includes(searchTerm)) {
                    score = 1;
                }
                // 4. ×¦×™×•×Ÿ 0.5: ×”×›×œ×” ×—×œ×§×™×ª ×‘×”×’×“×¨×” (×”×¤×™×¨×•×©)
                else if (item.definition.toLowerCase().includes(searchTerm)) {
                    score = 0.5;
                }

                return { ...item, score, item }; // ××—×–×™×¨×™× ××ª ×”××•×‘×™×™×§×˜ ×”××§×•×¨×™ ×¢× ×”×¦×™×•×Ÿ
            });

            // ×¡×™× ×•×Ÿ, ××™×•×Ÿ ×œ×¤×™ ×¦×™×•×Ÿ (××”×’×‘×•×” ×œ× ××•×š) ×•×”×’×‘×œ×”
            const filteredAndSortedData = scoredData
                .filter(entry => entry.score > 0) // ××¡× ×Ÿ ×”×—×•×¦×” ××ª ××œ×• ×©×œ× × ××¦××• ×›×œ×œ
                .sort((a, b) => b.score - a.score) // ×××™×™×Ÿ ××”×¦×™×•×Ÿ ×”×’×‘×•×” ×œ× ××•×š
                .slice(0, MAX_RESULTS) // ××’×‘×™×œ ×œ-5 ×”×ª×•×¦××•×ª ×”×¨××©×•× ×•×ª
                .map(entry => entry.item); // ××—×–×™×¨ ×¨×§ ××ª ××•×‘×™×™×§×˜ ×”××™×œ×” ×”××§×•×¨×™

            renderResults(filteredAndSortedData);
        }

        /**
         * ××¨× ×“×¨ ××ª ×”×ª×•×¦××•×ª ×‘×ª×•×š ×”××›×•×œ×”.
         */
        function renderResults(data) {
            resultsContainer.innerHTML = data.map(createResultCardHtml).join('');

            if (data.length === 0) {
                searchStatus.textContent = `ğŸ˜” ×œ× × ××¦××• ××•× ×—×™× ××ª××™××™× ×œ×—×™×¤×•×© "${searchInput.value}".`;
            } else {
                searchStatus.textContent = `× ××¦××• ${data.length} ×”××•× ×—×™× ×”×¨×œ×•×•× ×˜×™×™× ×‘×™×•×ª×¨ (××ª×•×š ×¢×“ 5). ×œ×—×¥ ×¢×œ ×›×¨×˜×™×¡ ×œ×¤×™×¨×•×˜ ×”××œ×:`;
            }
        }

        /**
         * ×¤×•× ×§×¦×™×™×ª ××ª×—×•×œ - ×›×•×œ×œ×ª ×˜×¢×™× ×ª × ×ª×•× ×™×
         */
        window.onload = async function () {
            // ×”×¦×’×ª ×”×•×“×¢×ª ×˜×¢×™× ×”
            termCountElement.textContent = '×˜×•×¢×Ÿ...';
            termCountElement.classList.remove('text-red-700');
            termCountElement.classList.add('text-gray-500');
            searchStatus.textContent = '×˜×•×¢×Ÿ × ×ª×•× ×™ ××™×œ×•×Ÿ ×¨××©×•× ×™×™×...';


            // --- ×©×œ×‘ 1: ×˜×¢×™× ×ª ×”× ×ª×•× ×™× ×-JSON ---
            try {
                // ** ×—Ö¸×©××•Ö¼×‘: ×”×§×¨×™××” ×œ-fetch ×× ×™×—×” ×©×§×•×‘×¥ terms.json × ××¦× ×‘××•×ª×” ×ª×™×§×™×™×” **
                const response = await fetch('terms.json');
                
                // ×‘×“×™×§×” ×× ×”-Fetch ×”×¦×œ×™×— (×§×•×“ 200)
                if (!response.ok) {
                    throw new Error(`Failed to load terms.json. Status: ${response.status}.`);
                }
                
                dictionaryData = await response.json();
                
                // --- ×©×œ×‘ 2: ××ª×—×•×œ ×××©×§ ×”××©×ª××© ×œ××—×¨ ×”×˜×¢×™× ×” ---
                
                // ×¢×“×›×•×Ÿ ××•× ×” ×”××•× ×—×™×
                termCountElement.textContent = dictionaryData.length;
                termCountElement.classList.remove('text-gray-500');
                termCountElement.classList.add('text-red-700');

                // ×”×•×¡×¤×ª ×××–×™×Ÿ ×œ××™×¨×•×¢×™ ×§×œ×˜
                searchInput.addEventListener('input', applySearch);
                
                // ××¦×‘ ×¨××©×•× ×™: ×œ× ××¦×™×’ ×ª×•×¦××•×ª, ×¨×§ ×× ×—×”
                resultsContainer.innerHTML = '';
                searchStatus.textContent = '×”×§×œ×“ ××™×œ×” ×‘×¢×‘×¨×™×ª ××• ×‘×× ×’×œ×™×ª ×›×“×™ ×œ×—×¤×© ×‘×§×•×“×§×¡.';
            
            } catch (error) {
                console.error("Error loading dictionary data:", error);
                
                // ×”×¦×’×ª ×”×•×“×¢×ª ×©×’×™××” ×‘×¨×•×¨×” ×‘×××©×§ ×”××©×ª××©
                termCountElement.textContent = '×©×’×™××”';
                termCountElement.classList.remove('text-gray-500');
                termCountElement.classList.add('text-red-700');
                searchStatus.textContent = 'âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: × ×ª×•× ×™ ×”××™×œ×•×Ÿ (terms.json) ×œ× × ×˜×¢× ×•. ×‘×“×•×§ ×©×”×§×•×‘×¥ ×§×™×™× ×•× ×’×™×©. ×¤×ª×— ××ª ×§×•× ×¡×•×œ×ª ×”×“×¤×“×¤×Ÿ ×œ×¤×¨×˜×™× × ×•×¡×¤×™×.';
                
                // ××•× ×¢ ××¤×©×¨×•×ª ×—×™×¤×•×© ×× ×”× ×ª×•× ×™× ×œ× × ×˜×¢× ×•
                searchInput.disabled = true; 
            }
        };
    </script>
</body>
</html>
