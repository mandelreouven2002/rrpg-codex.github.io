<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拽拽住  砖拽 转驻拽</title>
    
    <!-- 注转 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 注转 驻 ALEF -Inter (驻) -->
    <link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* 专转 驻 专砖 - 爪转 砖砖 -Alef */
        body {
            font-family: 'Alef', Inter, sans-serif;
            direction: rtl;
            text-align: right;
        }
        /*  转爪  - 住  */
        .modal-content {
            max-height: 80vh;
            overflow-y: auto;
            /* 住 /驻专爪'  -  注拽 爪 注 */
            box-shadow: 0 5px 20px rgba(120, 53, 15, 0.5); 
            border: 4px solid #78350f; /* Deep Amber/Brown */
        }
    </style>
</head>

<!-- 专拽注 专,  驻专爪'/ - Stone-100 -->
<body class="bg-stone-100 text-gray-900 p-4 md:p-8">

    <!-- 转专转 拽专 砖 - 住专转 住驻专 注转拽 - Stone-200 -->
    <header class="mb-8 p-4 bg-stone-200 shadow-lg border-b-4 border-amber-900">
        <div class="flex justify-between items-center flex-wrap gap-4 mb-4">
            <!-- H1: 爪注  注拽 (Sepia) -->
            <h1 class="text-3xl font-bold text-amber-900">拽拽住  砖拽 转驻拽</h1>
            
                <!-- 拽砖专  - 3 驻转专 -->
                <div class="flex items-center gap-3 md:gap-4"> 
                    
                    <!-- 1. 驻转专 祝 转 (爪注 专砖) -->
                    <a href="index.html" class="inline-block px-4 py-2 bg-red-800 text-white text-base font-bold rounded-sm shadow-md hover:bg-red-900 transition duration-300 transform hover:scale-[1.01] whitespace-nowrap">
                        祝 转
                    </a>
                    
                    <!-- 2. 拽砖专 转 (驻转专 砖  ) -->
                    <a href="about.html" class="inline-block px-4 py-2 bg-amber-900 text-white text-base font-bold rounded-sm shadow-md hover:bg-amber-700 transition duration-300 transform hover:scale-[1.01] whitespace-nowrap">
                        转
                    </a>
                    
                    <!-- 3. 驻转专 注专   (驻转专 砖  转) -->
                    <a href="codex.html" class="inline-block px-4 py-2 bg-amber-900 text-white text-base font-bold rounded-sm shadow-md hover:bg-amber-700 transition duration-300 transform hover:scale-[1.01] whitespace-nowrap">
                         
                    </a>
                </div>
        </div>
        
        <div class="flex flex-col md:flex-row gap-4">
            <!-- 专 驻砖 -   拽 -->
            <input type="text" id="search-input" placeholder="驻砖 ..."
                   class="flex-1 p-3 border-2 border-amber-900 bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-4 focus:ring-amber-700 transition duration-150 rounded-sm">
            
            <!-- 专 住 驻 转转 -   拽 -->
            <select id="tag-filter"
                    class="p-3 border-2 border-amber-900 bg-white text-gray-900 focus:outline-none focus:ring-4 focus:ring-amber-700 transition duration-150 rounded-sm">
                <option value="" class="bg-white"> 砖</option>
                <!-- 驻砖专转 注 注" JS -->
            </select>
        </div>
    </header>
    
    <!-- 专砖转  专住驻住转 -->
    <main id="dictionary-grid" class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-6">
        <!-- 砖爪转 注  注" JavaScript -->
    </main>
    
    <!-- 注转 注/ 转爪转 - 拽住 爪注  拽 -->
    <p id="loading-message" class="text-center text-lg text-amber-900 mt-12">注 转 拽专...</p>
    <!-- 注转 砖  注注 -->
    <p id="no-results-message" class="text-center text-lg text-red-700 mt-12 hidden">  爪 专砖转 转转 拽拽住 转.</p>
    
    <!-- ---  拽驻抓 (Modal) - 注爪 专 住专 --- -->
    <div id="word-modal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4 hidden">
        <!-- 专拽注 拽 转专  - Stone-50 -->
        <div class="modal-content bg-stone-50 w-full max-w-2xl rounded-sm shadow-2xl p-6 transition-all transform scale-100">
            <div class="flex justify-between items-start border-b border-amber-900 pb-3 mb-4">
                <!-- 转专转  - 爪注  注拽 -->
                <h2 id="modal-title" class="text-3xl font-bold text-amber-900"></h2>
                <button id="close-modal" class="text-gray-600 hover:text-amber-900 text-3xl font-light leading-none pr-2 transition duration-200">
                    &times;
                </button>
            </div>
            <div id="modal-body">
                <!-- 转   住  -->
            </div>
        </div>
    </div>
    
    <!-- --- 驻专 - 专 住 --- -->
    <footer class="mt-12 pt-4 border-t-2 border-amber-900 bg-stone-200 text-center text-sm p-4 rounded-t-sm space-y-1">
        <p class="text-amber-900">
             注" <a href="https://rrpg.top" target="_blank" class="font-bold text-amber-700 hover:text-amber-900 underline transition"> - 砖拽 转驻拽 注 拽</a>
        </p>
        <p class="text-amber-900">
            驻转 注" <a href="https://lp.reuven.click" target="_blank" class="font-bold text-amber-700 hover:text-amber-900 underline transition">专 抓'</a>
        </p>
    </footer>

    <!-- JavaScript  拽, 驻砖, 住 拽砖专 注拽 -->
    <script>
        // --- 转  (JSON) - 注  ---        
        let dictionaryData = []; 

        // --- 拽注 砖转  ---
        const gridContainer = document.getElementById('dictionary-grid');
        const searchInput = document.getElementById('search-input');
        const tagFilter = document.getElementById('tag-filter');
        const modal = document.getElementById('word-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const closeButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');
        const noResultsMessage = document.getElementById('no-results-message');
        
        const HEBREW_DETAILS_MAP = {
            gender: "",
            binyan: "",
            root: "砖专砖",
            inflection: "",
            verbInflection: "转 驻注"
        };
        const MAX_PREVIEW_LENGTH = 100;         
        const MAX_VISIBLE_TAGS = 3; 

        // --- 驻拽爪转 驻 -URL (拽 驻注) ---
        function encodeWord(word) {
            return encodeURIComponent(word);
        }
        
        function decodeWord(encodedWord) {
            try {
                return decodeURIComponent(encodedWord);
            } catch (e) {
                console.error("Failed to decode URI component:", encodedWord, e);
                return '';
            }
        }
        
        // --- 驻拽爪转 注专 ---
        function truncateText(text, maxLength = MAX_PREVIEW_LENGTH) {
            if (text.length <= maxLength) {
                return text;
            }
            return text.substring(0, maxLength).trim() + '...';
        }

        /**
         *  转 拽 -HTML 砖 砖爪转  (Card).
         * @param {Object} item - 拽  .
         * @returns {string} - 专转 HTML 砖 砖爪转.
         */
        function createCardHtml(item) {
            const cardId = encodeWord(item.word); 
            const definitionPreview = truncateText(item.definition);
            const visibleTags = item.tags.slice(0, MAX_VISIBLE_TAGS);
            const extraTagsCount = item.tags.length - MAX_VISIBLE_TAGS;

            let tagsHtml = visibleTags.map(tag =>
                `<span class="tag inline-block bg-red-900/10 text-red-700 text-xs font-medium px-2.5 py-0.5 rounded-sm ml-2 whitespace-nowrap border border-red-900/50">${tag}</span>`
            ).join('');

            if (extraTagsCount > 0) {
                tagsHtml += `<span class="tag inline-block bg-stone-200 text-gray-700 text-xs font-medium px-2.5 py-0.5 rounded-sm ml-2 whitespace-nowrap border border-stone-300">+${extraTagsCount}</span>`;
            }

            // 注爪 专住: 专拽注 驻专爪' 专 (stone-50),  拽, 爪 注  注拽
            return `
                <div data-id="${cardId}" 
                     data-tags="${item.tags.join(' ')}" 
                     class="word-card bg-stone-50 p-5 border-2 border-amber-900 rounded-sm shadow-[0_5px_15px_rgba(120,53,15,0.2)] hover:shadow-[0_8px_20px_rgba(120,53,15,0.4)] hover:scale-[1.02] transition transform duration-300 cursor-pointer" 
                     tabindex="0">
                    
                    <!--  专砖转: 爪注  注拽 (Sepia) -->
                    <h2 class="main-word text-2xl font-extrabold text-amber-900 mb-2">${item.word}</h2>
                    
                    <div class="tags-list mb-3 flex flex-wrap gap-y-1">
                        ${tagsHtml}
                    </div>

                    <p class="source-en text-base text-gray-600 mb-2 font-medium">拽专 (EN): ${item.sourceEn}</p>

                    <p class="definition-preview text-base text-gray-800 font-medium">
                        ${definitionPreview}
                    </p>
                </div>
            `;
        }

        /**
         * 专专 转  转 -Grid.
         * @param {Array} data - 注专  爪.
         */
        function renderCards(data) {
            gridContainer.innerHTML = data.map(createCardHtml).join('');

            if (data.length === 0) {
                noResultsMessage.classList.remove('hidden');
            } else {
                noResultsMessage.classList.add('hidden');
            }

            // 住驻转 Event Listeners  砖爪转 砖
            document.querySelectorAll('.word-card').forEach(card => {
                card.addEventListener('click', () => openModal(card.dataset.id));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        openModal(card.dataset.id);
                    }
                });
            });
        }

        /**
         * 驻转 转  拽驻抓 注 转 -URL (Hash).
         * @param {string} encodedWordId -  拽转 (驻 砖驻注 -data-id).
         */
        function openModal(encodedWordId) {
            const wordToFind = decodeWord(encodedWordId); 
            // 驻砖 住祝 转  注
            const word = dictionaryData.find(item => item.word === wordToFind); 
            if (!word) return;

            // 1. 注 -URL (Deep Linking) 爪注转 Hash (#)
            if (window.location.hash.substring(1) !== encodedWordId) {
                window.location.hash = `#${encodedWordId}`;
            }

            // 2. 转 转  拽驻抓
            modalTitle.textContent = word.word;

            // 转 转 驻专  
            let fullDetailsTable = Object.keys(HEBREW_DETAILS_MAP)
                .map(key => ({
                    label: HEBREW_DETAILS_MAP[key],
                    value: word.hebrewDetails[key]
                }))
                .filter(detail => detail.value && detail.value.trim() !== '');

            // 转  转转 
            const allTagsHtml = word.tags.map(tag =>
                `<span class="tag inline-block bg-red-900/10 text-red-700 text-sm font-medium px-3 py-1 rounded-sm ml-2 border border-red-900/50">${tag}</span>`
            ).join('');

            // 拽住 专 注专 
            const fullDetailsHtml = `
                <div class="tags-list mb-4 flex flex-wrap gap-y-1">
                    ${allTagsHtml}
                </div>

                <p class="source-en text-sm text-gray-600 mb-4">拽专 转: <span class="font-semibold">${word.sourceEn}</span></p>

                <!-- 驻专 注专  - 爪 专拽  -->
                ${fullDetailsTable.length > 0 ? `
                    <!-- 转专转: 爪注  注拽 -->
                    <h3 class="text-xl font-semibold mt-4 mb-2 border-b border-amber-900 pb-1 text-amber-900">驻专 砖 (注专):</h3>
                    <table class="w-full text-base text-gray-700">
                        <tbody>
                            ${fullDetailsTable.map(d => `
                                <tr class="border-b border-stone-300 last:border-b-0">
                                    <th class="py-1 pr-0 font-bold w-1/3 text-right text-amber-900">${d.label}:</th>
                                    <td class="py-1 pl-0 font-normal w-2/3 text-right">${d.value}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                ` : ''}

                <!-- 转专转: 爪注  注拽 -->
                <h3 class="text-xl font-semibold mt-6 mb-2 border-b border-amber-900 pb-1 text-amber-900">驻专砖 :</h3>
                <p class="text-lg mb-6 leading-relaxed text-gray-800">${word.definition}</p>

                <!-- 转专转: 爪注  注拽 -->
                <h3 class="text-xl font-semibold mt-6 mb-2 border-b border-amber-900 pb-1 text-amber-900">砖砖 转:</h3>
                <ul class="list-disc pr-5 space-y-2 text-gray-800">
                    ${word.usages.map(u => `<li>${u}</li>`).join('')}
                </ul>
            `;
            modalBody.innerHTML = fullDetailsHtml;

            // 3. 爪转  拽驻抓
            modal.classList.remove('hidden');
        }

        /**
         * 住专 转  拽驻抓 注 转 -URL 住住.
         */
        function closeModal() {
            modal.classList.add('hidden');
            // 住专转 驻专专 -URL 爪注转 Hash
            window.location.hash = '';
        }

        /**
         * 驻注 转 驻砖 住 注  转 注.
         */
        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedTag = tagFilter.value;

            const filteredData = dictionaryData.filter(item => {
                if (!item || !item.word) return false;

                // 1. 住 驻砖 拽住
                const searchMatch = item.word.toLowerCase().includes(searchTerm) ||
                                    item.definition.toLowerCase().includes(searchTerm) ||
                                    item.sourceEn.toLowerCase().includes(searchTerm);

                // 2. 住 转转
                const tagMatch = !selectedTag || item.tags.includes(selectedTag);

                return searchMatch && tagMatch;
            });
            renderCards(filteredData);
        }

        /**
         * 注 转  转转 转 住 转 转转 专.
         */
        function populateTags() {
            const allTags = dictionaryData.flatMap(item => item.tags || []); //  砖转 拽
            const uniqueTags = [...new Set(allTags)].sort();

            const optionsHtml = uniqueTags.map(tag =>
                `<option value="${tag}" class="bg-white">${tag}</option>`
            ).join('');

            // 砖专 转 驻砖专转 " 砖"
            tagFilter.innerHTML = `<option value="" class="bg-white"> 砖</option>` + optionsHtml;
        }

        /**
         * 拽  砖 驻专专  -URL 驻转 转  拽驻抓 转.
         */
        function checkUrlForWord() {
            const encodedWordId = window.location.hash.substring(1); 
            if (encodedWordId) {
                // 砖砖 -setTimeout 拽爪专   砖  专专 驻 驻转转 
                setTimeout(() => openModal(encodedWordId), 100);
            }
        }

        /**
         * 驻拽爪转 注 专砖转 - 拽专转 转 -JSON 驻注 转 拽
         */
        window.onload = async function() {
            // --- 砖 1: 注转 转 -JSON ---
            try {
                const response = await fetch('terms.json');
                if (!response.ok) throw new Error('Failed to load terms.json');
                
                dictionaryData = await response.json();
                loadingMessage.classList.add('hidden'); // 住转专转 注转 注
                
            } catch (error) {
                console.error("Error loading dictionary data:", error);
                loadingMessage.textContent = '专注 砖 拽专转 注转 转 .';
                loadingMessage.classList.remove('hidden');
                loadingMessage.classList.add('text-red-700', 'font-bold');
                return; // 驻住拽转 转
            }

            // --- 砖 2: 驻注转 拽 拽专转 ---
            populateTags();
            renderCards(dictionaryData);
            checkUrlForWord();

            // 5. 住驻转  驻拽 砖
            searchInput.addEventListener('input', applyFilters);
            tagFilter.addEventListener('change', applyFilters);
            closeButton.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // 6. 驻 驻转专 "专" 驻驻 (Browser Back Button)
            window.addEventListener('popstate', (e) => {
                const encodedWordId = window.location.hash.substring(1);

                if (encodedWordId) {
                    openModal(encodedWordId);
                } else {
                    if (!modal.classList.contains('hidden')) { 
                         modal.classList.add('hidden');
                    }
                }
            });
        };
    </script>
</body>
</html>
